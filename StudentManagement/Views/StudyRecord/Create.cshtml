@model StudentManagement.Models.StudyRecord
@{
    ViewData["Title"] = "Create Student Record";
}

<style>


    h1 {
        text-align: center;
        color: #333;
        font-size: 28px;
        font-weight: bold;
        margin-bottom: 50px;
        letter-spacing: 1px;
    }

    .form-container {
        background-color: white;
        padding: 50px;
        margin: 0 auto;
        max-width: 900px;
    }

    .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px 60px;
        margin-bottom: 40px;
    }

    .form-row {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .form-row label {
        min-width: 150px;
        text-align: right;
        font-size: 14px;
        color: #333;
    }

    .required {
        color: red;
        margin-left: 2px;
    }

    .form-row input,
    .form-row select {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid #333;
        border-radius: 4px;
        font-size: 14px;
        font-family: Arial, sans-serif;
    }

    .comments-row {
        margin-top: 30px;
        display: flex;
        align-items: flex-start;
        gap: 20px;
    }

    .comments-row label {
        min-width: 150px;
        text-align: right;
        font-size: 14px;
        color: #333;
        padding-top: 8px;
    }

    .comments-row textarea {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid #333;
        border-radius: 4px;
        font-size: 14px;
        font-family: Arial, sans-serif;
        resize: vertical;
        min-height: 80px;
    }

    .submit-container {
        text-align: center;
        margin-top: 40px;
    }

    .submit-btn {
        background-color: white;
        color: #000;
        padding: 12px 40px;
        border: 2px solid #000;
        border-radius: 4px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        letter-spacing: 1px;
    }

    .submit-btn:hover {
        background-color: #f0f0f0;
    }
</style>

<h1>CREATE STUDENT RECORD</h1>

@if (TempData["ErrorMessage"] != null)
{
    <div style="background-color: #f8d7da; color: #721c24; padding: 15px; margin: 20px auto; max-width: 900px; border: 1px solid #f5c6cb; border-radius: 4px; text-align: center;">
        <strong>@TempData["ErrorMessage"]</strong>
    </div>
}

<div class="form-container">
        <form method="post" action="/StudyRecord/Create">
            <div class="form-grid">
                <!-- Left column -->
                <div class="form-row">
                    <label for="Team">Team<span class="required">*</span></label>
                    <select id="Team" name="Team">
                        <option value="">-- Select --</option>
                        <option value="@ViewBag.UserTeam" selected>@ViewBag.UserTeam</option>
                    </select>
                </div>

                <!-- Right column -->
                <div class="form-row">
                    <label for="Environment">Environment<span class="required">*</span></label>
                    <select id="Environment" name="Environment">
                        <option value="">-- Select --</option>
                        <option value="Dev" selected="@(Model?.Environment == "Dev" ? "selected" : null)">Dev</option>
                        <option value="Test" selected="@(Model?.Environment == "Test" ? "selected" : null)">Test</option>
                        <option value="Prod" selected="@(Model?.Environment == "Prod" ? "selected" : null)">Prod</option>
                    </select>
                </div>

                <!-- Left column -->
                <div class="form-row">
                    <label for="FirstName">FirstName<span class="required">*</span></label>
                    <input type="text" id="FirstName" name="FirstName" value="@Model?.FirstName" />
                </div>

                <!-- Right column -->
                <div class="form-row">
                    <label for="StudentIQLevel">Student IQ Level<span class="required">*</span></label>
                    <input type="text" id="StudentIQLevel" name="StudentIQLevel" value="@Model?.StudentIQLevel" />
                </div>

                <!-- Left column -->
                <div class="form-row">
                    <label for="MiddleName">MiddleName<span class="required">*</span></label>
                    <input type="text" id="MiddleName" name="MiddleName" value="@Model?.MiddleName" />
                </div>

                <!-- Right column -->
                <div class="form-row">
                    <label for="StudentRollNumber">Student RollNumber<span class="required">*</span></label>
                    <input type="text" id="StudentRollNumber" name="StudentRollNumber" value="@Model?.StudentRollNumber" />
                </div>

                <!-- Left column -->
                <div class="form-row">
                    <label for="LastName">LastName<span class="required">*</span></label>
                    <input type="text" id="LastName" name="LastName" value="@Model?.LastName" />
                </div>

                <!-- Right column -->
                <div class="form-row">
                    <label for="StudentRollName">Student RollName<span class="required">*</span></label>
                    <input type="text" id="StudentRollName" name="StudentRollName" value="@Model?.StudentRollName" />
                </div>

                <!-- Left column -->
                <div class="form-row">
                    <label for="DateOfBirth">Date Of Birth<span class="required">*</span></label>
                    <input type="text" id="DateOfBirth" name="DateOfBirth" value="@Model?.DateOfBirth" />
                </div>

                <!-- Right column -->
                <div class="form-row">
                    <label for="StudentParentEmailAddress">Student Parent Email Address<span class="required">*</span></label>
                    <input type="text" id="StudentParentEmailAddress" name="StudentParentEmailAddress" value="@Model?.StudentParentEmailAddress" />
                </div>

                <!-- Left column -->
                <div class="form-row">
                    <label for="EmailAddress">Email Address<span class="required">*</span></label>
                    <input type="text" id="EmailAddress" name="EmailAddress" value="@Model?.EmailAddress" readonly style="background-color: #f5f5f5; cursor: not-allowed;" />
                </div>

                <!-- Right column -->
                <div class="form-row">
                    <label for="Status">Status<span class="required">*</span></label>
                    <input type="text" id="Status" name="Status" value="@Model?.Status" />
                </div>

                <!-- Left column -->
                <div class="form-row">
                    <label for="StudentIdentityID">StudentIdentityID<span class="required">*</span></label>
                    <select id="StudentIdentityID" name="StudentIdentityID">
                        <option value="">-- Select --</option>
                        <option value="ID1" selected="@(Model?.StudentIdentityID == "ID1" ? "selected" : null)">ID1</option>
                        <option value="ID2" selected="@(Model?.StudentIdentityID == "ID2" ? "selected" : null)">ID2</option>
                        <option value="ID3" selected="@(Model?.StudentIdentityID == "ID3" ? "selected" : null)">ID3</option>
                    </select>
                </div>

                <!-- Right column -->
                <div class="form-row">
                    <label for="Type">Type<span class="required">*</span></label>
                    <input type="text" id="Type" name="Type" value="@Model?.Type" />
                </div>

                <!-- Left column -->
                <div class="form-row">
                    <label for="StudentInitialID">StudentInitialID<span class="required">*</span></label>
                    <input type="text" id="StudentInitialID" name="StudentInitialID" value="@Model?.StudentInitialID" />
                </div>

                <!-- Right column -->
                <div class="form-row">
                    <label for="Tags">Tags<span class="required">*</span></label>
                    <input type="text" id="Tags" name="Tags" value="@Model?.Tags" />
                </div>

                <!-- Left column -->
                <div class="form-row">
                    <label for="Release">Release<span class="required">*</span></label>
                    <input type="text" id="Release" name="Release" value="@Model?.Release" />
                </div>
            </div>

            <!-- Comments field - full width -->
            <div class="comments-row">
                <label for="Comments">Comments<span class="required">*</span></label>
                <textarea id="Comments" name="Comments" maxlength="200" placeholder="Maximum 200 characters">@Model?.Comments</textarea>
            </div>

            <div class="submit-container">
                <button type="submit" class="submit-btn" onclick="return validateForm()">
                    CREATE STUDENT
                </button>
            </div>
        </form>
    </div>

<script>
    let nextRecordId = 1;

    // Fetch the next available record ID when page loads
    document.addEventListener('DOMContentLoaded', function() {
        fetchNextRecordId();

        // Add change event listeners to Team, Environment, and Type fields
        document.getElementById('Team').addEventListener('change', generateEmailAddress);
        document.getElementById('Environment').addEventListener('change', generateEmailAddress);
        document.getElementById('Type').addEventListener('change', generateEmailAddress);
    });

    function fetchNextRecordId() {
        fetch('/StudyRecord/GetNextStudyRecordId')
            .then(response => response.json())
            .then(data => {
                nextRecordId = data.nextId;
                generateEmailAddress();
            })
            .catch(error => {
                console.error('Error fetching next record ID:', error);
            });
    }

    function generateEmailAddress() {
        const team = document.getElementById('Team').value;
        const environment = document.getElementById('Environment').value;
        const type = document.getElementById('Type').value;

        if (team && environment && type && team !== '-- Select --' && environment !== '-- Select --') {
            // Format the ID with leading zeros (e.g., 001, 002, 010, 100)
            const formattedId = String(nextRecordId).padStart(3, '0');
            const email = `${team}-${environment}-${type}-${formattedId}@@gmail.com`;
            document.getElementById('EmailAddress').value = email;
        } else {
            document.getElementById('EmailAddress').value = '';
        }
    }

    function validateForm() {
        const requiredFields = [
            { id: 'Team', name: 'Team' },
            { id: 'Environment', name: 'Environment' },
            { id: 'FirstName', name: 'First Name' },
            { id: 'StudentIQLevel', name: 'Student IQ Level' },
            { id: 'MiddleName', name: 'Middle Name' },
            { id: 'StudentRollNumber', name: 'Student Roll Number' },
            { id: 'LastName', name: 'Last Name' },
            { id: 'StudentRollName', name: 'Student Roll Name' },
            { id: 'DateOfBirth', name: 'Date Of Birth' },
            { id: 'StudentParentEmailAddress', name: 'Student Parent Email Address' },
            { id: 'EmailAddress', name: 'Email Address' },
            { id: 'Status', name: 'Status' },
            { id: 'StudentIdentityID', name: 'Student Identity ID' },
            { id: 'Type', name: 'Type' },
            { id: 'StudentInitialID', name: 'Student Initial ID' },
            { id: 'Tags', name: 'Tags' },
            { id: 'Release', name: 'Release' },
            { id: 'Comments', name: 'Comments' }
        ];

        let missingFields = [];

        for (let field of requiredFields) {
            const element = document.getElementById(field.id);
            const value = element.value.trim();

            if (!value || value === '-- Select --' || value === '') {
                missingFields.push(field.name);
            }
        }

        if (missingFields.length > 0) {
            alert('Missing Mandatory study record data');
            return false;
        }

        return true;
    }
</script>
